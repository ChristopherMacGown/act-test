name: CI
on: 
  push:
  pull_request:
    branches: ['main']
  workflow_dispatch:
jobs:
  test:
    uses: ./.github/workflows/test.yml
  lint:
    uses: ./.github/workflows/lint.yml
  format:
    needs: [lint, test]
    if: ${{ failure('lint') && !failure('test') && github.branch != 'main' }}
    uses: ./.github/workflows/format.yml
    secrets: inherit
    permissions:
      contents: write
  build:
    runs-on: ubuntu-latest
    needs: [format]
    if:  ${{ always() && !failure('lint') && !failure('test') }}
    steps:
      - run: echo "BUILD"
  deploy:
    runs-on: ubuntu-latest
    needs: [build]
    if: ${{ always() && !failure('build') && github.branch == 'main' }}
    steps:
      - run: echo "DEPLOY"